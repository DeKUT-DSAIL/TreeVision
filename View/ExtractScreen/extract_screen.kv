#:import dp kivy.metrics.dp

<ExtractScreenView>:
    image_plane: image_plane
    left_im: left_im
    right_im: right_im
    overlay_layout: overlay_layout
    overlay: overlay
    previous_arrow: previous_arrow
    next_arrow: next_arrow
    project_name: project_name
    images_select: images_select
    parameter_dropdown_item: parameter_dropdown_item
    segmentation_dropdown_item: segmentation_dropdown_item


    FloatLayout:
        size: root.size
        FloatLayout:
            size_hint_y: .6
            pos_hint: {'top': 1}

            # left and right images
            MDBoxLayout:
                id: image_plane
                pos_hint: {'top': 1}
                AnchorLayout:
                    anchor_x: 'left'
                    Image:
                        id: left_im
                        source: "/mnt/kieni/kieni-13-03-2023/left/IMG_20230309_103936_RIGHT.jpg"
                        size: self.texture_size
                        allow_stretch: True
                AnchorLayout:
                    anchor_x: 'right'
                    Image:
                        id: right_im
                        source: "/mnt/kieni/kieni-13-03-2023/right/IMG_20230309_103936_LEFT.jpg"
                        size: self.texture_size
                        allow_stretch: True
            
            FloatLayout:
                id: overlay_layout
                pos_hint: {'y': 0}
                size_hint_y: None
                height: self.parent.height * 0.15

                Widget:
                    id: overlay
                    canvas.before:
                        Color:
                            rgba: 0,0,0,0.5
                        Rectangle:
                            pos: self.parent.pos
                            size: self.parent.size
        
                MDIconButton:
                    id: previous_arrow
                    icon: 'arrow-left-circle-outline'
                    md_bg_color: app.theme_cls.primary_color
                    pos_hint: {"center_x": .47, "center_y": .5}


                MDIconButton:
                    id: next_arrow
                    icon: 'arrow-right-circle-outline'
                    md_bg_color: app.theme_cls.primary_color
                    pos_hint: {"center_x": .53, "center_y": .5}
                

                MDIconButton:
                    id: reset
                    icon: 'cog-refresh-outline'
                    widget_style: 'ios'
                    theme_icon_color: 'Custom'
                    icon_color: 'white'
                    md_bg_color: .15, .65, .9, 1
                    pos_hint: {"center_x": .95, "center_y": .5}
                    on_release: root.controller.reset()

        # Configurations and logging
        MDBoxLayout:
            size_hint: 1, 0.05
            pos_hint: {'top': 0.395}
            padding: "10dp", "10dp"
            md_bg_color: app.theme_cls.primary_color
            MDLabel:
                text: "Configs"
        MDBoxLayout:
            orientation: "horizontal"
            size_hint: 1, 0.3
            pos_hint: {'top': 0.345}

            # COLUMN 1: LOADING IMAGES
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                padding: "10dp", "10dp"
                MDBoxLayout:
                    size_hint_y: None
                    height: "30dp"
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Project name: "
                            color: 0, 0, 0, 1
                    AnchorLayout:
                        anchor_x: 'right'
                        TextInput:
                            id: project_name
                            multiline: False
                MDBoxLayout:
                    MDLabel:
                        text: "Upload:"
                MDBoxLayout:
                    spacing: dp(0), "10dp"
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Images folder:"
                    AnchorLayout:
                        anchor_x: 'right'
                        MDRectangleFlatIconButton:
                            id: images_select
                            text: "Select"
                            icon: "folder"
                            size_hint_x: 1
                            on_release: root.controller.file_manager_open('folder')
                MDBoxLayout:
                    spacing: dp(0), "10dp"
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Calibration file (YML):"
                    AnchorLayout:
                        anchor_x: 'right'
                        MDRectangleFlatIconButton:
                            text: "Select"
                            icon: "file"
                            size_hint_x: 1
                            on_release: root.controller.file_manager_open('file')
                    
            
            # COLUMN 3: GENERAL CONFIGURATIONS 
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                padding: '10dp', '10dp'
                MDBoxLayout:
                    spacing: '10dp'
                    size_hint_y: None
                    height: "30dp"
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Actual (cm): "
                            color: 0, 0, 0, 1
                    AnchorLayout:
                        anchor_x: 'right'
                        TextInput:
                            multiline: False
                MDBoxLayout:
                    # spacing: 10
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Parameter to estimate: "
                    AnchorLayout:
                        anchor_x: 'right'
                        MDDropDownItem:
                            id: parameter_dropdown_item
                            size_hint_x: 1
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            text: 'Select parameter'
                            background_color: [1,0,0,1]
                            on_release: root.controller.parameter_menu.open()
                MDBoxLayout:
                    # spacing: 10
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Segmentation Approach"
                    AnchorLayout:
                        anchor_x: 'right'
                        MDDropDownItem:
                            id: segmentation_dropdown_item
                            size_hint_x: 1
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            text: 'Select approach'
                            on_release: root.controller.segmentation_menu.open()
                MDBoxLayout:
                    orientation: 'vertical'
                    spacing: 10

                    MDBoxLayout:
                        spacing: 10
                        AnchorLayout:
                            anchor_x: 'left'
                            MDRaisedButton:
                                text: "Extract"
                                md_bg_color: "green"
                                on_release: root.controller.on_extract()
                        AnchorLayout:
                            anchor_x: 'right'
                            MDRaisedButton:
                                text: "Batch Extract"
                                md_bg_color: "green"
                                on_release: root.controller.update_on_batch_extract()


            # COLUMN 3: LOGGING INFORMATION
            MDBoxLayout:
                orientation: 'vertical'
                MDProgressBar:
                    id: progress_bar
                    color: "green"
                    size_hint_y: 0.3
                    max: 100
                    value: 0
                MDScrollView:  
                    id: scrollview
                    MDBoxLayout:
                        id: scroll_layout
                        orientation: 'vertical'
                        md_bg_color: 0, 0, 0, 1
                        size_hint: 1, None
                        padding: 20, 50
                        height: self.minimum_height
        
        # This is the bottom strip
        MDBoxLayout:
            size_hint: 1, 0.045
            pos_hint: {"top": 0.045}
            md_bg_color: app.theme_cls.primary_dark