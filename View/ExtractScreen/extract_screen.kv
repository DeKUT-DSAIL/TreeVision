#:import dp kivy.metrics.dp

<ExtractScreenView>:
    image_plane: image_plane
    left_im: left_im
    right_im: right_im
    project_name: project_name
    verify_checkbox: verify_checkbox
    parameter_dropdown_item: parameter_dropdown_item
    segmentation_dropdown_item: segmentation_dropdown_item


    FloatLayout:
        size: root.size
        orientation: "vertical"
        MDBoxLayout:
            id: image_plane
            orientation: "horizontal"
            size_hint_y: .6
            pos_hint: {'top': 0.995}

            # This canvas is a dark overlay over the images
            canvas.after:
                Color:
                    rgba: 0, 0, 0, 0.5
                Rectangle:
                    pos: self.pos
                    size: (self.parent.width, 0.2*self.parent.height)

            # left and right images
            Image:
                id: left_im
                source: "/home/cedric/kieni-species-annotation/13-03-2023/IMG_20230309_103936_RIGHT.jpg"
                size: self.texture_size
                allow_stretch: True
            Image:
                id: right_im
                source: "/home/cedric/kieni-species-annotation/13-03-2023/IMG_20230309_103936_RIGHT.jpg"
                size: self.texture_size
                allow_stretch: True
                keep_ration: False
        
        MDFloatingActionButton:
            icon: 'arrow-left-circle-outline'
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .47, "center_y": .5}
            on_release: root.controller.show_next_image('previous')

        MDFloatingActionButton:
            icon: 'arrow-right-circle-outline'
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {"center_x": .53, "center_y": .5}
            on_release: root.controller.show_next_image('next')

        # Configurations and logging
        MDBoxLayout:
            size_hint: 1, 0.05
            pos_hint: {'top': 0.395}
            padding: "10dp", "10dp"
            md_bg_color: app.theme_cls.primary_color
            MDLabel:
                text: "Configs"
        MDBoxLayout:
            orientation: "horizontal"
            size_hint: 1, 0.3
            pos_hint: {'top': 0.345}

            # COLUMN: LOADING IMAGES
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                padding: "10dp", "10dp"
                MDGridLayout:
                    cols: 2
                    size_hint_y: None
                    height: "30dp"
                    MDLabel:
                        text: "Project name: "
                        color: 0, 0, 0, 1
                    TextInput:
                        id: project_name
                        multiline: False
                MDGridLayout:
                    cols: 2
                    MDLabel:
                        text: "Upload:"
                    MDGridLayout:
                        cols: 2
                        MDLabel:
                            text: "Verify"
                        MDCheckbox:
                            id: verify_checkbox
                            active: True
                MDGridLayout:
                    cols: 2
                    spacing: "0dp", "10dp"
                    MDLabel:
                        text: "Left Images:"
                    MDRectangleFlatIconButton:
                        id: left_select
                        text: "Load"
                        icon: "folder"
                        size_hint_x: 1
                        on_release: root.controller.file_manager_open('left')
                    MDLabel:
                        text: "Right Images:"
                    MDRectangleFlatIconButton:
                        id: right_select
                        text: "Load"
                        icon: "folder"
                        size_hint_x: 1
                        on_release: root.controller.file_manager_open('right')
            
            # COLUMN: GENERAL CONFIGURATIONS 
            MDBoxLayout:
                orientation: "vertical"
                size_hint_x: 0.8
                padding: '10dp', '10dp'
                MDBoxLayout:
                    spacing: '10dp'
                    size_hint_y: None
                    height: "30dp"
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Actual (cm): "
                            color: 0, 0, 0, 1
                    AnchorLayout:
                        anchor_x: 'right'
                        TextInput:
                            multiline: False
                MDBoxLayout:
                    # spacing: 10
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Parameter to estimate: "
                    AnchorLayout:
                        anchor_x: 'right'
                        MDDropDownItem:
                            id: parameter_dropdown_item
                            size_hint_x: 1
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            text: 'Select parameter'
                            background_color: [1,0,0,1]
                            on_release: root.controller.parameter_menu.open()
                MDBoxLayout:
                    # spacing: 10
                    AnchorLayout:
                        anchor_x: 'left'
                        MDLabel:
                            text: "Segmentation Algorithm"
                    AnchorLayout:
                        anchor_x: 'right'
                        MDDropDownItem:
                            id: segmentation_dropdown_item
                            size_hint_x: 1
                            pos_hint: {'center_x': .5, 'center_y': .5}
                            text: 'Select algorithm'
                            on_release: root.controller.segmentation_menu.open()
                MDBoxLayout:
                    orientation: 'vertical'
                    spacing: 10

                    MDBoxLayout:
                        spacing: 10
                        AnchorLayout:
                            anchor_x: 'left'
                            MDRaisedButton:
                                text: "Extract"
                                md_bg_color: "green"
                                on_release: root.controller.on_extract()
                        AnchorLayout:
                            anchor_x: 'right'
                            MDRaisedButton:
                                text: "Batch Extract"
                                md_bg_color: "green"
                                on_release: root.controller.update_on_batch_extract()


            # LOGGING INFORMATION
            MDLabel:
                text: "Logs"
                color: 0,0,0,1
                halign: "center"
        
        # This is the bottom strip
        MDBoxLayout:
            size_hint: 1, 0.045
            pos_hint: {"top": 0.045}
            md_bg_color: app.theme_cls.primary_dark